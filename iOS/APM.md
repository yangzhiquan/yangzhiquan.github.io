[TOC]

## 内存监控
内存监控组件可以帮助你轻松实现**OOM监控**、**大内存分配监控**、**内存泄漏检测**，**内存触顶率监控**等功能，当发生内存相关问题时记录问题线程堆栈，为后续问题定位提供现场记录。 



## 卡顿监控模块
卡顿监控模块通过在主线程`Runloop`中添加`CADisplayLink`监听每一次`vsync`信号的执行，判断两次回调时间间隔，如果判定发生卡顿或死锁，记录对应的卡顿或死锁堆栈，便于查看并进一步分析和解决问题。

**默认卡顿判定条件：**
* 卡顿检测：默认连续3帧即50ms认为发生卡顿；
* 死锁检测：默认超过5s不响应认为发生死锁。


## 启动耗时监控模块
从进程的processInfo获取进程的启动时间，结合用户在`main`函数调用的start以及`application:didFinishLaunchingWithOptions:`、第一个vc的`viewDidApppear:`时间，来统计启动耗时.


## VC泄露监控模块
监控App中的`ViewController`是否合理释放，对于未合理释放的VC对象，判断未泄漏并上报。

    swizzleAllMethod函数会替换所有的vc展示/关闭函数（包括pushViewController、popViewControllerAnimated等），每当vc展示的时候都创建一个WeakVCModel，用一个weak变量指向这个vc。(如果开始view泄露监控还会创建一个WeakViewModel用一个的weak变量指向vc的view)
    当页面pop销毁的时候，取出对应的model，在延迟一段时间后检查弱持有的weak变量是否为nil，不是则回调泄露通知.


## 资源监控模块
监控设备各项资源指标，包括CPU利用率，线程，内存使用，I/O，定位服务使用状态，电池状态，FPS，绘制次数等

* CPU利用率，当前线程数；
* 内存使用，dirty和空闲内存；
* IO数据，普通文件I/O和Socket I/O数据；
* FPS值；
* 电池充电状态；
* 是否正在定位。

## 耗电监控模块
监控设备在CPU使用率超过80%时，过滤CPU使用率超过5%的单个线程，抓取对应线程堆栈，将收集到的线程堆栈组合成一颗函数调用树形成 Energy Log，反映当前设备在CPU超过80%时的最耗电的线程调用堆栈，便于查看并进一步分析和解决问题。


## 内存图
内存图是通过`libmalloc`提供的接口，获取所有堆内存分配节点；并根据节点中指针内容，建立起内存引用关系图的能力。

通过内存图，可以对当前状态下的堆内存状态进行分析：



